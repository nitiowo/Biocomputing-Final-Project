#1 SupportingFunctions.R


#a Function to convert Delimited files to CSV
convertToCSV <- function(directory) {
  files <- list.files(directory, pattern="\\.txt$", full.names=TRUE)
  for (file in files) {
    data <- read.table(file, header=TRUE, sep="", fill=TRUE, check.names=TRUE)
    csvName <- sub("\\.txt$", ".csv", file)
    write.csv(data, csvName, row.names=FALSE)
  }
}
#b Function to compile CSV files into a single file
compileCSV <- function(directory, removeNA=FALSE, warnNA=TRUE) {
  files <- list.files(directory, pattern="\\.csv$", full.names=TRUE)
  compiledData <- NULL
  for (file in files) {
    data <- read.csv(file)
    if (removeNA) {
      data <- na.omit(data)
    } else if (warnNA && any(is.na(data))) {
      warning("NA values found in file: ", file)
    }
    compiledData <- rbind(compiledData, data)
  }
  write.csv(compiledData, file.path(directory, "compiled_data.csv"), row.names=FALSE)
}
#c Function to summarize Data
summarizeData <- function(data) {
  totalScreens <- nrow(data)
  infectedRate <- mean(data$infected, na.rm=TRUE)
  genderDistribution <- table(data$gender) / totalScreens
  ageDistribution <- hist(data$age, plot=FALSE)
  list(totalScreens=totalScreens, infectedRate=infectedRate, 
       genderDistribution=genderDistribution, ageDistribution=ageDistribution)
}
#d Function to analyze Genetic Markers
analyzeGeneticMarkers <- function(data) {
  data$infected <- rowSums(data[, c("marker1", "marker2", ..., "marker10")]) > 0
  return(data)
}

#e Function to summarize marker Data
summarizeMarkers <- function(data) {
  countrySummary <- aggregate(. ~ country, data, function(x) mean(x, na.rm = TRUE))
  return(countrySummary)
}


#2 analysis.R


#I will use my supportingFunctions.R to analyze the data
# Load supporting functions
source("supportingFunctions.R")

# Convert delimited files to CSV
convertToCSV("path/to/delimited/files")

# Compile CSV files into a single file
compileCSV("path/to/csv/files", removeNA=TRUE)

# Read compiled data
compiledData <- read.csv("path/to/csv/files/compiled_data.csv")

# Summarize the data
summary <- summarizeData(compiledData)

# Graphical Evidence

# Question 1
# Line graph of infections over time for each country

# Aggregate data by country and day of year
infectionsByDay <- aggregate(infected ~ country + dayOfYear, data=compiledData, sum)

# Plotting
library(ggplot2)
ggplot(infectionsByDay, aes(x=dayOfYear, y=infected, color=country, group=country)) +
  geom_line() +
  labs(title="Infections Over Time by Country", x="Day of Year", y="Number of Infections") +
  theme_classic()

# Answer to the question once code is ran

# Question 2
#Bar Pots for Frequences of each Marker

# Prepare data for plotting
markers <- compiledData[, c("country", "marker1", "marker2", ..., "marker10")]
markersMelted <- reshape2::melt(markers, id.vars = "country")

# Plotting
ggplot(markersMelted, aes(x=variable, y=value, fill=country)) +
  geom_bar(stat="identity", position=position_dodge()) +
  labs(title="Frequency of Each Marker by Country", x="Marker", y="Frequency") +
  theme_classic()

# Answer to question when plotted 

# Stephan Lukashev
